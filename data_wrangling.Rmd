---
title: "Data Wrangling"
output: html_document
---

**dplyr** is a widely adopted r package, part of tidyverse, which uses **five English verbs** to reshape data

```{r load-packages, message=FALSE, warning=FALSE}
library(tidyverse)
```

## Arrange


```{r transform-cars, message=FALSE, warning=FALSE, include=FALSE}
# There is some crazy data conversion problem with the cars dataFrame.  But since I only did that to show people how to load data  (see data_management.Rmd,)  I'm transforming 'cars' in a more robust fashion with `rownames_to_column`
cars <- rownames_to_column(mtcars, "makeModel")

makeModel_temp <- cars$makeModel

cars$makeModel <- NULL

cars$makeModel <- makeModel_temp
  
```


**Arrange** to sort rows by column
```{r arrange, message=FALSE, warning=FALSE}
cars %>% 
  arrange(cyl, desc(mpg), desc(hp))
```

## Select
**Select** to choose columns (variables)
```{r select}
cars %>% 
    arrange(cyl, desc(mpg), desc(hp)) %>% 
    select(makeModel, cyl, mpg, hp)
```


## Filter

**Filter** to select rows
```{r filter}
sixcyls <- cars %>% 
  filter(cyl == 6)

sixcyls    # display filtered data frame
```

## Mutate

**Mutate** to create new variables (add columns) 
```{r mutate}
sixcyls %>% 
  mutate(dispWt = disp / wt) %>% 
  select(makeModel, cyl, mpg, hp, dispWt)
```

## Count
**Count** to summarize observations (or rows)
```{r count}
sixcyls %>% 
  count(hp)
```

Note:  `count()` is not part of the five dplyr verbs.  It's often used with `summarize` and included for it's the brevity of functionality.  The example below will demonstrate the flexibility of the `summarize()` function which is a dplyr verb.

## Summarize
Summarize to collapse values into a summary

```{r}
sixcyls %>% 
  group_by(hp) %>% 
  summarize(Count = n(), mean_wt = mean(wt), min_wt = min(wt), max_wt = max(wt))
```


## Put it all together

We can pipe commands together.  Think of a pipe (i.e. `%>%`) as a conjunction.  Any time you see a pipe, think "and then."

```{r alltogether}

cars %>% 
  filter(cyl >= 4, cyl <= 6) %>% 
  select(makeModel, mpg:wt) %>%
  mutate(dispWt = disp / wt) %>% 
  arrange(desc(mpg), wt)
```
